### 并发的两个关键问题

线程间如何通信？即：线程之间以何种机制来交换信息

线程间如何同步？即：线程以何种机制来控制不同线程间操作发生的相对顺序

有两种并发模型可以解决这两个问题：

- 消息传递并发模型

- 共享内存并发模型  (**java使用**)

- 对于每一个线程来说，栈都是私有的，而堆是共有的。

  也就是说在栈中的变量（局部变量、方法定义参数、异常处理器参数）不会在线程之间共享，也就不会有内存可见性的问题，也不受内存模型的影响。而在堆中的变量是共享的，本文称为共享变量。

  所以，内存可见性是针对的**共享变量**。

* 既然堆是共享的，为什么在堆中会有内存不可见问题?

  这是因为现代计算机为了⾼效，往往会在⾼速缓存区中缓存共享变量，因为cpu访问缓存区⽐访问内存要快得多。

  JMM又规定:

  1. 所有的共享变量都存在主内存中。 

  2. 每个线程都保存了⼀份该线程使⽤到的共享变量的副本。

  3. 如果线程A与线程B之间要通信的话，必须经历下⾯2个步骤：

      i.  线程A将本地内存A中更新过的共享变量刷新到主内存中去。

      ii.  线程B到主内存中去读取线程A之前已经更新过的共享变量。

  **所以，线程A⽆法直接访问线程B的⼯作内存，线程间通信必须经过主内存。**

  